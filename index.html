<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	</head>
	<body>
		<style>
			* { padding: 0; margin: 0; overflow: hidden; }
			.info { z-index: 1; position: absolute; right: 10px; bottom: 10px; }
		</style>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/87/three.min.js"></script>
		<script src="http://threejs.org/examples/js/controls/OrbitControls.js"></script>
		<script src="keycaps.json"></script>

		<div class="info"><a href="https://github.com/joric/keycaps">github</a><div>

		<script>
			var container, stats;
			var camera, cameraTarget, scene, renderer;
			var geometries = [];

			init();
			animate();

			function init() {
				container = document.createElement( 'div' );
				document.body.appendChild( container );

				function makeTexture(w, h, color, textColor, text) {
					var canvas = document.createElement( 'canvas' );
					canvas.width = w;
					canvas.height = h;
					var ctx = canvas.getContext( '2d' );
					ctx.fillStyle = color;
					ctx.fillRect(0, 0, w, h);
					var tx = canvas.width / 2;
					var ty = canvas.height / 2;
					ctx.font = 'Bold 32px Arial';
					ctx.textAlign='center';
					ctx.fillStyle = textColor;
					ctx.fillText(text, tx, ty);
					return canvas;
				}

				renderer = new THREE.WebGLRenderer( { antialias: false } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
				window.addEventListener( 'resize', onWindowResize, false );

				scene = new THREE.ObjectLoader().parse(data);

				camera = scene.getObjectByName("Camera");
				onWindowResize();

				pointLight = new THREE.PointLight( 0xffffff );
				pointLight.position.set(1,1,2);
				camera.add(pointLight);

				scene.traverse( function( node ) {
					if ( node instanceof THREE.Mesh ) {
						var material = new THREE.MeshPhongMaterial( { color: 0xffffff, specular: 0x101010, wireframe: false } )
						var caption = node.name;
						var canvas = makeTexture(256, 256, '#404040', '#ffffff', caption);
						var texture =  new THREE.Texture(canvas);
						material.map = texture;
						material.map.needsUpdate = true;
						node.material = material;
						node.geometry.scale(-1,-1,1);
					}
				});

				camera.up.set( 0, 0, 1 );
				controls = new THREE.OrbitControls( camera );
				scene.background = new THREE.Color( 0xdddddd );

			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			function animate() {
				requestAnimationFrame( animate );
				render();
			}

			function render() {
				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>
